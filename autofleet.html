<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a237e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>AutoFleet Manager</title>
    <style>
        :root {
            --primary: #1a237e;
            --primary-light: #534bae;
            --primary-dark: #000051;
            --secondary: #00bcd4;
            --surface: #ffffff;
            --background: #f5f7fa;
            --error: #e53935;
            --warning: #ff9800;
            --success: #4caf50;
            --text-primary: #212121;
            --text-secondary: #757575;
            --shadow-1: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-2: 0 4px 8px rgba(0,0,0,0.12);
            --shadow-3: 0 8px 16px rgba(0,0,0,0.14);
            --radius-sm: 8px;
            --radius-md: 16px;
            --radius-lg: 24px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        body {
            background: var(--background);
            color: var(--text-primary);
            padding-bottom: 80px;
            line-height: 1.5;
        }

        /* Header */
        .app-bar {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 16px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-2);
        }

        .vehicle-selector {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255,255,255,0.15);
            padding: 12px 16px;
            border-radius: var(--radius-md);
            backdrop-filter: blur(10px);
            margin-top: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .vehicle-selector:active {
            transform: scale(0.98);
            background: rgba(255,255,255,0.25);
        }

        .vehicle-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .vehicle-plate {
            background: white;
            color: var(--primary);
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 700;
            font-size: 14px;
            letter-spacing: 1px;
        }

        .vehicle-name {
            font-weight: 600;
            font-size: 16px;
        }

        .chevron {
            font-size: 20px;
            opacity: 0.7;
        }

        /* Vehicle Card */
        .vehicle-card {
            background: var(--surface);
            margin: 16px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-2);
            overflow: hidden;
            position: relative;
        }

        .vehicle-image {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 64px;
            position: relative;
        }

        .vehicle-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .vehicle-stats {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.7));
            padding: 20px 16px 16px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
        }

        .stat-label {
            font-size: 11px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .vehicle-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.2s;
        }

        .icon-btn:active {
            transform: scale(0.9);
            background: rgba(255,255,255,0.3);
        }

        /* Documents Section */
        .section-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin: 24px 16px 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .document-list {
            background: var(--surface);
            margin: 0 16px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-1);
            overflow: hidden;
        }

        .document-item {
            display: flex;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid #f0f0f0;
            position: relative;
            transition: background 0.2s;
        }

        .document-item:last-child {
            border-bottom: none;
        }

        .document-item:active {
            background: #f5f5f5;
        }

        .document-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: #e8eaf6;
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-right: 16px;
            flex-shrink: 0;
        }

        .document-icon.warning {
            background: #fff3e0;
            color: var(--warning);
        }

        .document-icon.danger {
            background: #ffebee;
            color: var(--error);
        }

        .document-info {
            flex: 1;
        }

        .document-title {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 2px;
        }

        .document-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .document-status {
            text-align: right;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .status-badge.active {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-badge.warning {
            background: #fff3e0;
            color: #ef6c00;
        }

        .status-badge.expired {
            background: #ffebee;
            color: #c62828;
        }

        .days-left {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .add-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px dashed #ccc;
            background: transparent;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-left: 8px;
            transition: all 0.2s;
        }

        .add-btn:active {
            background: #f5f5f5;
            transform: scale(0.95);
        }

        /* Quick Actions Grid */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin: 16px;
        }

        .action-card {
            background: var(--surface);
            border-radius: var(--radius-md);
            padding: 16px 8px;
            text-align: center;
            box-shadow: var(--shadow-1);
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-card:active {
            transform: translateY(2px);
            box-shadow: var(--shadow-2);
        }

        .action-icon {
            width: 48px;
            height: 48px;
            background: #e8f5e9;
            color: var(--success);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin: 0 auto 8px;
        }

        .action-icon.blue { background: #e3f2fd; color: var(--primary); }
        .action-icon.orange { background: #fff3e0; color: var(--warning); }
        .action-icon.red { background: #ffebee; color: var(--error); }
        .action-icon.cyan { background: #e0f7fa; color: var(--secondary); }

        .action-label {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-primary);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--surface);
            box-shadow: 0 -4px 12px rgba(0,0,0,0.08);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 8px 0 calc(8px + env(safe-area-inset-bottom));
            z-index: 100;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            background: none;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-item.active .nav-icon {
            background: #e8eaf6;
        }

        .nav-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 20px;
            transition: all 0.2s;
        }

        .fab {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            font-size: 24px;
            box-shadow: var(--shadow-3);
            margin-top: -24px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab:active {
            transform: scale(0.95) rotate(90deg);
            box-shadow: var(--shadow-1);
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 200;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal-sheet {
            background: var(--surface);
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            padding: 24px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(100%);
            transition: transform 0.3s;
            margin-top: auto;
        }

        .modal-overlay.active .modal-sheet {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }

        .close-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: #f5f5f5;
            color: var(--text-secondary);
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: var(--radius-md);
            font-size: 16px;
            transition: border-color 0.3s;
            background: transparent;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn-primary {
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: var(--shadow-1);
            transition: all 0.2s;
            margin-top: 8px;
        }

        .btn-primary:active {
            transform: translateY(1px);
            box-shadow: none;
        }

        .btn-secondary {
            width: 100%;
            padding: 16px;
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 12px;
        }

        .btn-danger {
            width: 100%;
            padding: 16px;
            background: var(--error);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 12px;
        }

        .vehicles-list {
            max-height: 60vh;
            overflow-y: auto;
        }

        .vehicle-option {
            display: flex;
            align-items: center;
            padding: 16px;
            border-radius: var(--radius-md);
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .vehicle-option:active {
            background: #f5f5f5;
        }

        .vehicle-option.selected {
            border-color: var(--primary);
            background: #e8eaf6;
        }

        .vehicle-option .plate {
            background: var(--primary);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 700;
            margin-right: 12px;
            font-size: 13px;
        }

        .fuel-list {
            margin: 0 16px;
        }

        .fuel-item {
            background: var(--surface);
            border-radius: var(--radius-md);
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: var(--shadow-1);
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 12px;
            align-items: center;
        }

        .fuel-date {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .fuel-type {
            font-weight: 600;
            font-size: 15px;
        }

        .fuel-stats {
            text-align: right;
        }

        .fuel-price {
            font-weight: 700;
            color: var(--primary);
            font-size: 16px;
        }

        .fuel-consumption {
            font-size: 12px;
            color: var(--success);
            font-weight: 600;
        }

        .empty-state {
            text-align: center;
            padding: 48px 24px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .consumption-chart {
            background: var(--surface);
            margin: 16px;
            padding: 20px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-1);
        }

        .chart-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-secondary);
        }

        .chart-bar {
            display: flex;
            align-items: flex-end;
            height: 100px;
            gap: 8px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 8px;
            margin-bottom: 8px;
        }

        .bar {
            flex: 1;
            background: linear-gradient(to top, var(--primary), var(--primary-light));
            border-radius: 4px 4px 0 0;
            transition: all 0.3s;
            position: relative;
            min-height: 4px;
        }

        .bar:hover {
            opacity: 0.8;
        }

        .bar-label {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .notification {
            position: fixed;
            top: 16px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: #333;
            color: white;
            padding: 12px 24px;
            border-radius: 24px;
            font-size: 14px;
            font-weight: 500;
            box-shadow: var(--shadow-3);
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s;
        }

        .notification.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="app-bar">
    <div style="font-size: 20px; font-weight: 700;">üöó AutoFleet</div>
    <div class="vehicle-selector" onclick="openVehicleSelector()">
        <div class="vehicle-info">
            <div class="vehicle-plate" id="current-plate">CB1234MC</div>
            <div class="vehicle-name" id="current-name">Volkswagen Passat</div>
        </div>
        <div class="chevron">‚ñº</div>
    </div>
</div>

<div id="main-view">
    <!-- Vehicle Card -->
    <div class="vehicle-card">
        <div class="vehicle-image" id="vehicle-image">
            <div style="font-size: 80px;">üöô</div>
            <div class="vehicle-stats">
                <div class="stat-item">
                    <div class="stat-value" id="stat-km">212653</div>
                    <div class="stat-label">–∫–º</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="stat-consumption">6.8</div>
                    <div class="stat-label">–ª/100–∫–º</div>
                </div>
                <div class="vehicle-actions">
                    <button class="icon-btn" onclick="editCurrentVehicle()" title="–†–µ–¥–∞–∫—Ü–∏—è">‚úèÔ∏è</button>
                    <button class="icon-btn" onclick="deleteCurrentVehicle()" title="–ò–∑—Ç—Ä–∏–π">üóëÔ∏è</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Documents -->
    <div class="section-title">
        <span>–î–æ–∫—É–º–µ–Ω—Ç–∏</span>
        <span style="color: var(--error); font-size: 11px;" id="expired-count"></span>
    </div>
    
    <div class="document-list">
        <div class="document-item" onclick="openDocumentModal('tax')">
            <div class="document-icon" id="icon-tax">üí∞</div>
            <div class="document-info">
                <div class="document-title">–î–∞–Ω—ä–∫ –ú–ü–°</div>
                <div class="document-subtitle" id="subtitle-tax">–ù—è–º–∞ –∑–∞–ø–∏—Å–∞–Ω –¥–∞–Ω—ä–∫</div>
            </div>
            <div class="document-status">
                <span class="status-badge hidden" id="badge-tax">–ê–ö–¢–ò–í–ï–ù</span>
                <div class="days-left" id="days-tax"></div>
            </div>
            <button class="add-btn" onclick="event.stopPropagation(); openDocumentModal('tax')">+</button>
        </div>

        <div class="document-item" onclick="openDocumentModal('insurance')">
            <div class="document-icon" id="icon-insurance">üõ°Ô∏è</div>
            <div class="document-info">
                <div class="document-title">–ì—Ä–∞–∂–¥–∞–Ω—Å–∫–∞ –æ—Ç–≥–æ–≤–æ—Ä–Ω–æ—Å—Ç</div>
                <div class="document-subtitle" id="subtitle-insurance">–ù—è–º–∞ –∑–∞–ø–∏—Å–∞–Ω–∞ –∑–∞—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞</div>
            </div>
            <div class="document-status">
                <span class="status-badge hidden" id="badge-insurance">–ê–ö–¢–ò–í–ï–ù</span>
                <div class="days-left" id="days-insurance"></div>
            </div>
            <button class="add-btn" onclick="event.stopPropagation(); openDocumentModal('insurance')">+</button>
        </div>

        <div class="document-item" onclick="openDocumentModal('inspection')">
            <div class="document-icon" id="icon-inspection">üîç</div>
            <div class="document-info">
                <div class="document-title">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –ø—Ä–µ–≥–ª–µ–¥</div>
                <div class="document-subtitle" id="subtitle-inspection">–ù—è–º–∞ –∑–∞–ø–∏—Å–∞–Ω –ø—Ä–µ–≥–ª–µ–¥</div>
            </div>
            <div class="document-status">
                <span class="status-badge hidden" id="badge-inspection">–ê–ö–¢–ò–í–ï–ù</span>
                <div class="days-left" id="days-inspection"></div>
            </div>
            <button class="add-btn" onclick="event.stopPropagation(); openDocumentModal('inspection')">+</button>
        </div>

        <div class="document-item" onclick="openDocumentModal('casco')">
            <div class="document-icon" id="icon-casco">üõ°Ô∏è</div>
            <div class="document-info">
                <div class="document-title">–ö–∞—Å–∫–æ</div>
                <div class="document-subtitle" id="subtitle-casco">–ù—è–º–∞ –∑–∞–ø–∏—Å–∞–Ω–∞ –∑–∞—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞</div>
            </div>
            <div class="document-status">
                <span class="status-badge hidden" id="badge-casco">–ê–ö–¢–ò–í–ï–ù</span>
                <div class="days-left" id="days-casco"></div>
            </div>
            <button class="add-btn" onclick="event.stopPropagation(); openDocumentModal('casco')">+</button>
        </div>

        <div class="document-item" onclick="openDocumentModal('vignette')">
            <div class="document-icon" id="icon-vignette">üé´</div>
            <div class="document-info">
                <div class="document-title">–í–∏–Ω–µ—Ç–∫–∞</div>
                <div class="document-subtitle" id="subtitle-vignette">–ù—è–º–∞ –∑–∞–ø–∏—Å–∞–Ω–∞ –≤–∏–Ω–µ—Ç–∫–∞</div>
            </div>
            <div class="document-status">
                <span class="status-badge hidden" id="badge-vignette">–ê–ö–¢–ò–í–ï–ù</span>
                <div class="days-left" id="days-vignette"></div>
            </div>
            <button class="add-btn" onclick="event.stopPropagation(); openDocumentModal('vignette')">+</button>
        </div>

        <div class="document-item" onclick="openDocumentModal('fire')">
            <div class="document-icon" id="icon-fire">üßØ</div>
            <div class="document-info">
                <div class="document-title">–ü–æ–∂–∞—Ä–æ–≥–∞—Å–∏—Ç–µ–ª</div>
                <div class="document-subtitle" id="subtitle-fire">–ù—è–º–∞ –∑–∞–ø–∏—Å–∞–Ω –ø—Ä–µ–≥–ª–µ–¥</div>
            </div>
            <div class="document-status">
                <span class="status-badge hidden" id="badge-fire">–ê–ö–¢–ò–í–ï–ù</span>
                <div class="days-left" id="days-fire"></div>
            </div>
            <button class="add-btn" onclick="event.stopPropagation(); openDocumentModal('fire')">+</button>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="section-title">–ë—ä—Ä–∑–∏ –¥–µ–π—Å—Ç–≤–∏—è</div>
    <div class="quick-actions">
        <div class="action-card" onclick="openFuelModal()">
            <div class="action-icon cyan">‚õΩ</div>
            <div class="action-label">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ</div>
        </div>
        <div class="action-card" onclick="showNotification('–§—É–Ω–∫—Ü–∏—è—Ç–∞ –µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞')">
            <div class="action-icon orange">üîî</div>
            <div class="action-label">–ù–∞–ø–æ–º–Ω—è–Ω–∏—è</div>
        </div>
        <div class="action-card" onclick="showNotification('–§—É–Ω–∫—Ü–∏—è—Ç–∞ –µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞')">
            <div class="action-icon blue">üîß</div>
            <div class="action-label">–†–µ–º–æ–Ω—Ç–∏</div>
        </div>
        <div class="action-card" onclick="openFuelHistory()">
            <div class="action-icon">üìä</div>
            <div class="action-label">–†–∞–∑—Ö–æ–¥</div>
        </div>
    </div>
</div>

<!-- Fuel View -->
<div id="fuel-view" class="hidden">
    <div class="consumption-chart">
        <div class="chart-title">–†–∞–∑—Ö–æ–¥ –Ω–∞ –≥–æ—Ä–∏–≤–æ (–ª/100–∫–º)</div>
        <div class="chart-bar" id="consumption-chart">
            <!-- Bars generated by JS -->
        </div>
    </div>
    
    <div class="section-title">–ò—Å—Ç–æ—Ä–∏—è –Ω–∞ –∑–∞—Ä–µ–∂–¥–∞–Ω–∏—è—Ç–∞</div>
    <div class="fuel-list" id="fuel-list">
        <div class="empty-state">
            <div class="empty-icon">‚õΩ</div>
            <div>–ù—è–º–∞ –∑–∞–ø–∏—Å–∞–Ω–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–∏—è</div>
        </div>
    </div>
</div>

<!-- Bottom Navigation -->
<div class="bottom-nav">
    <button class="nav-item active" onclick="showView('main')" id="nav-main">
        <div class="nav-icon">üè†</div>
        <span>–ù–∞—á–∞–ª–æ</span>
    </button>
    <button class="nav-item" onclick="showView('fuel')" id="nav-fuel">
        <div class="nav-icon">‚õΩ</div>
        <span>–ì–æ—Ä–∏–≤–æ</span>
    </button>
    <button class="fab" onclick="openAddMenu()">+</button>
    <button class="nav-item" onclick="showNotification('–ö–∞–ª–µ–Ω–¥–∞—Ä')">
        <div class="nav-icon">üìÖ</div>
        <span>–ö–∞–ª–µ–Ω–¥–∞—Ä</span>
    </button>
    <button class="nav-item" onclick="openVehicleSelector()">
        <div class="nav-icon">üöó</div>
        <span>–ê–≤—Ç–æ–º–æ–±–∏–ª–∏</span>
    </button>
</div>

<!-- Vehicle Selector Modal -->
<div class="modal-overlay" id="vehicle-selector-modal">
    <div class="modal-sheet">
        <div class="modal-header">
            <div class="modal-title">–ò–∑–±–µ—Ä–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª</div>
            <button class="close-btn" onclick="closeModal('vehicle-selector-modal')">‚úï</button>
        </div>
        <div class="vehicles-list" id="vehicles-list">
            <!-- Generated by JS -->
        </div>
        <button class="btn-secondary" onclick="openAddVehicleModal()">+ –î–æ–±–∞–≤–∏ –Ω–æ–≤ –∞–≤—Ç–æ–º–æ–±–∏–ª</button>
    </div>
</div>

<!-- Add/Edit Vehicle Modal -->
<div class="modal-overlay" id="vehicle-modal">
    <div class="modal-sheet">
        <div class="modal-header">
            <div class="modal-title" id="vehicle-modal-title">–ù–æ–≤ –∞–≤—Ç–æ–º–æ–±–∏–ª</div>
            <button class="close-btn" onclick="closeModal('vehicle-modal')">‚úï</button>
        </div>
        <div class="form-group">
            <label class="form-label">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–µ–Ω –Ω–æ–º–µ—Ä</label>
            <input type="text" class="form-input" id="veh-plate" placeholder="–Ω–∞–ø—Ä. CB3318MC">
        </div>
        <div class="form-group">
            <label class="form-label">–ú–∞—Ä–∫–∞ –∏ –º–æ–¥–µ–ª</label>
            <input type="text" class="form-input" id="veh-name" placeholder="–Ω–∞–ø—Ä. Volkswagen Passat">
        </div>
        <div class="form-group">
            <label class="form-label">–ù–∞—á–∞–ª–µ–Ω –∫–∏–ª–æ–º–µ—Ç—Ä–∞–∂</label>
            <input type="number" class="form-input" id="veh-km" placeholder="–Ω–∞–ø—Ä. 212653">
        </div>
        <button class="btn-primary" onclick="saveVehicle()">–ó–∞–ø–∞–∑–∏</button>
        <button class="btn-secondary hidden" id="btn-cancel-veh" onclick="closeModal('vehicle-modal')">–û—Ç–∫–∞–∑</button>
    </div>
</div>

<!-- Document Modal -->
<div class="modal-overlay" id="document-modal">
    <div class="modal-sheet">
        <div class="modal-header">
            <div class="modal-title" id="doc-modal-title">–î–æ–∫—É–º–µ–Ω—Ç</div>
            <button class="close-btn" onclick="closeModal('document-modal')">‚úï</button>
        </div>
        <input type="hidden" id="doc-type">
        <div class="form-group">
            <label class="form-label">–î–∞—Ç–∞ –Ω–∞ –∏–∑—Ç–∏—á–∞–Ω–µ</label>
            <input type="date" class="form-input" id="doc-date">
        </div>
        <div class="form-group">
            <label class="form-label">–¶–µ–Ω–∞ (–ª–≤.)</label>
            <input type="number" class="form-input" id="doc-price" placeholder="0.00" step="0.01">
        </div>
        <div class="form-group">
            <label class="form-label">–ó–∞–±–µ–ª–µ–∂–∫–∞ (–Ω–µ–∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ)</label>
            <input type="text" class="form-input" id="doc-note" placeholder="–Ω–∞–ø—Ä. –°—Ä–æ–∫ 6 –º–µ—Å–µ—Ü–∞">
        </div>
        <button class="btn-primary" onclick="saveDocument()">–ó–∞–ø–∞–∑–∏</button>
        <button class="btn-danger hidden" id="btn-delete-doc" onclick="deleteDocument()">–ò–∑—Ç—Ä–∏–π –∑–∞–ø–∏—Å–∞</button>
    </div>
</div>

<!-- Fuel Modal -->
<div class="modal-overlay" id="fuel-modal">
    <div class="modal-sheet">
        <div class="modal-header">
            <div class="modal-title">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ —Å –≥–æ—Ä–∏–≤–æ</div>
            <button class="close-btn" onclick="closeModal('fuel-modal')">‚úï</button>
        </div>
        <div class="form-group">
            <label class="form-label">–î–∞—Ç–∞</label>
            <input type="date" class="form-input" id="fuel-date" value="">
        </div>
        <div class="form-group">
            <label class="form-label">–¢–∏–ø –≥–æ—Ä–∏–≤–æ</label>
            <select class="form-select" id="fuel-type">
                <option value="–ë–µ–Ω–∑–∏–Ω">–ë–µ–Ω–∑–∏–Ω 95</option>
                <option value="–ë–µ–Ω–∑–∏–Ω 100">–ë–µ–Ω–∑–∏–Ω 100</option>
                <option value="–î–∏–∑–µ–ª">–î–∏–∑–µ–ª</option>
                <option value="–ì–∞–∑">–ì–∞–∑/–ì–∞–∑ –ø—Ä–æ–ø–∞–Ω</option>
                <option value="–ï–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ">–ï–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ</option>
            </select>
        </div>
        <div class="form-group">
            <label class="form-label">–õ–∏—Ç—Ä–∏</label>
            <input type="number" class="form-input" id="fuel-liters" step="0.01" placeholder="0.00">
        </div>
        <div class="form-group">
            <label class="form-label">–¶–µ–Ω–∞ –æ–±—â–æ (–ª–≤.)</label>
            <input type="number" class="form-input" id="fuel-price" step="0.01" placeholder="0.00">
        </div>
        <div class="form-group">
            <label class="form-label">–ö–∏–ª–æ–º–µ—Ç—Ä–∞–∂</label>
            <input type="number" class="form-input" id="fuel-km" placeholder="–Ω–∞–ø—Ä. 212653">
        </div>
        <button class="btn-primary" onclick="saveFuel()">–ó–∞–ø–∞–∑–∏</button>
    </div>
</div>

<div class="notification" id="notification"></div>

<script>
// Data structure
let data = {
    vehicles: [],
    currentVehicleId: null
};

// Initialize
function init() {
    const saved = localStorage.getItem('autoFleetData');
    if (saved) {
        data = JSON.parse(saved);
    }
    
    // Request notification permission
    if ('Notification' in window && Notification.permission === 'default') {
        Notification.requestPermission();
    }
    
    if (data.vehicles.length === 0) {
        // Add demo vehicle
        addDemoData();
    }
    
    if (!data.currentVehicleId && data.vehicles.length > 0) {
        data.currentVehicleId = data.vehicles[0].id;
    }
    
    updateUI();
    setDefaultDates();
    checkNotifications();
    
    // Check every minute
    setInterval(checkNotifications, 60000);
}

function addDemoData() {
    data.vehicles.push({
        id: Date.now(),
        plate: 'CB3318MC',
        name: 'Volkswagen Passat',
        km: 212653,
        documents: {
            tax: { date: '2026-06-30', price: 250, notified: false },
            insurance: { date: '2026-08-15', price: 450, notified: false },
            inspection: { date: '2026-07-17', price: 60, notified: false },
            casco: null,
            vignette: { date: '2026-12-31', price: 97, notified: false },
            fire: null
        },
        fuelHistory: []
    });
    saveData();
}

function saveData() {
    localStorage.setItem('autoFleetData', JSON.stringify(data));
}

function getCurrentVehicle() {
    return data.vehicles.find(v => v.id === data.currentVehicleId);
}

function getDaysLeft(dateStr) {
    const end = new Date(dateStr);
    const today = new Date();
    today.setHours(0,0,0,0);
    const diff = end - today;
    return Math.ceil(diff / (1000 * 60 * 60 * 24));
}

function updateUI() {
    const vehicle = getCurrentVehicle();
    if (!vehicle) return;
    
    // Update header
    document.getElementById('current-plate').textContent = vehicle.plate;
    document.getElementById('current-name').textContent = vehicle.name;
    
    // Update stats
    document.getElementById('stat-km').textContent = vehicle.km.toLocaleString();
    
    // Calculate consumption
    const consumption = calculateAverageConsumption(vehicle);
    document.getElementById('stat-consumption').textContent = consumption ? consumption.toFixed(1) : '0.0';
    
    // Update documents
    const docTypes = ['tax', 'insurance', 'inspection', 'casco', 'vignette', 'fire'];
    let expiredCount = 0;
    
    docTypes.forEach(type => {
        const doc = vehicle.documents[type];
        const badge = document.getElementById(`badge-${type}`);
        const subtitle = document.getElementById(`subtitle-${type}`);
        const days = document.getElementById(`days-${type}`);
        const icon = document.getElementById(`icon-${type}`);
        
        if (doc && doc.date) {
            const daysLeft = getDaysLeft(doc.date);
            badge.classList.remove('hidden');
            icon.classList.remove('warning', 'danger');
            
            if (daysLeft < 0) {
                badge.className = 'status-badge expired';
                badge.textContent = '–ò–ó–¢–ï–ö–™–õ';
                days.textContent = `–ü—Ä–µ–¥–∏ ${Math.abs(daysLeft)} –¥–Ω–∏`;
                icon.classList.add('danger');
                expiredCount++;
            } else if (daysLeft <= 7) {
                badge.className = 'status-badge warning';
                badge.textContent = '–ò–ó–¢–ò–ß–ê';
                days.textContent = `–û—Å—Ç–∞–≤–∞—Ç ${daysLeft} –¥–Ω–∏`;
                icon.classList.add('warning');
            } else {
                badge.className = 'status-badge active';
                badge.textContent = '–ê–ö–¢–ò–í–ï–ù';
                days.textContent = `–û—Å—Ç–∞–≤–∞—Ç ${daysLeft} –¥–Ω–∏`;
            }
            
            subtitle.textContent = `–ò–∑—Ç–∏—á–∞: ${formatDate(doc.date)}${doc.price ? ' - ' + doc.price.toFixed(2) + ' –ª–≤' : ''}`;
        } else {
            badge.classList.add('hidden');
            days.textContent = '';
            subtitle.textContent = '–ù—è–º–∞ –∑–∞–ø–∏—Å–∞–Ω –¥–æ–∫—É–º–µ–Ω—Ç';
            icon.classList.remove('warning', 'danger');
        }
    });
    
    const expiredBadge = document.getElementById('expired-count');
    if (expiredCount > 0) {
        expiredBadge.textContent = `${expiredCount} –∏–∑—Ç–µ–∫–ª–∏`;
    } else {
        expiredBadge.textContent = '';
    }
    
    updateFuelList(vehicle);
}

function calculateAverageConsumption(vehicle) {
    if (vehicle.fuelHistory.length < 2) return 0;
    
    let totalConsumption = 0;
    let count = 0;
    
    for (let i = 0; i < vehicle.fuelHistory.length - 1; i++) {
        const current = vehicle.fuelHistory[i];
        const next = vehicle.fuelHistory[i + 1];
        const kmDiff = current.km - next.km;
        
        if (kmDiff > 0 && next.liters > 0) {
            totalConsumption += (next.liters / kmDiff * 100);
            count++;
        }
    }
    
    return count > 0 ? totalConsumption / count : 0;
}

function updateFuelList(vehicle) {
    const list = document.getElementById('fuel-list');
    
    if (vehicle.fuelHistory.length === 0) {
        list.innerHTML = `
            <div class="empty-state">
                <div class="empty-icon">‚õΩ</div>
                <div>–ù—è–º–∞ –∑–∞–ø–∏—Å–∞–Ω–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–∏—è</div>
            </div>
        `;
        updateConsumptionChart([]);
        return;
    }
    
    // Sort by date desc
    const sorted = [...vehicle.fuelHistory].sort((a, b) => new Date(b.date) - new Date(a.date));
    
    list.innerHTML = sorted.map((item, index) => {
        // Find previous entry for consumption calc
        const prevIndex = sorted.findIndex((_, i) => i > index && sorted[i].km < item.km);
        let consumptionStr = '';
        
        if (prevIndex !== -1) {
            const prev = sorted[prevIndex];
            const kmDiff = item.km - prev.km;
            if (kmDiff > 0) {
                const consumption = (item.liters / kmDiff * 100).toFixed(1);
                consumptionStr = `<div class="fuel-consumption">${consumption} –ª/100–∫–º</div>`;
            }
        }
        
        return `
            <div class="fuel-item">
                <div>
                    <div class="fuel-type">${item.fuelType}</div>
                    <div class="fuel-date">${formatDate(item.date)}</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-weight: 600;">${item.liters.toFixed(2)} –ª</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">${item.km.toLocaleString()} –∫–º</div>
                </div>
                <div class="fuel-stats">
                    <div class="fuel-price">${item.price.toFixed(2)} –ª–≤</div>
                    ${consumptionStr}
                </div>
            </div>
        `;
    }).join('');
    
    updateConsumptionChart(sorted);
}

function updateConsumptionChart(sorted) {
    const chart = document.getElementById('consumption-chart');
    
    if (sorted.length < 2) {
        chart.innerHTML = '<div style="text-align: center; width: 100%; color: #999; font-size: 12px;">–ù–µ–¥–æ—Å—Ç–∞—Ç—ä—á–Ω–æ –¥–∞–Ω–Ω–∏</div>';
        return;
    }
    
    // Get last 7 consumptions
    const consumptions = [];
    for (let i = 0; i < Math.min(7, sorted.length - 1); i++) {
        const current = sorted[i];
        const next = sorted[i + 1];
        const kmDiff = current.km - next.km;
        
        if (kmDiff > 0) {
            const consumption = (next.liters / kmDiff * 100);
            consumptions.push({
                value: consumption,
                label: new Date(next.date).toLocaleDateString('bg-BG', {day: '2-digit', month: '2-digit'})
            });
        }
    }
    
    if (consumptions.length === 0) {
        chart.innerHTML = '<div style="text-align: center; width: 100%; color: #999; font-size: 12px;">–ù–µ–¥–æ—Å—Ç–∞—Ç—ä—á–Ω–æ –¥–∞–Ω–Ω–∏</div>';
        return;
    }
    
    const max = Math.max(...consumptions.map(c => c.value));
    
    chart.innerHTML = consumptions.reverse().map(c => `
        <div class="bar" style="height: ${(c.value / max * 100)}%">
            <div class="bar-label">${c.label}</div>
        </div>
    `).join('');
}

// Modal Functions
function openVehicleSelector() {
    const list = document.getElementById('vehicles-list');
    list.innerHTML = data.vehicles.map(v => `
        <div class="vehicle-option ${v.id === data.currentVehicleId ? 'selected' : ''}" onclick="selectVehicle(${v.id})">
            <div class="plate">${v.plate}</div>
            <div>
                <div style="font-weight: 600;">${v.name}</div>
                <div style="font-size: 12px; color: var(--text-secondary);">${v.km.toLocaleString()} –∫–º</div>
            </div>
        </div>
    `).join('');
    
    document.getElementById('vehicle-selector-modal').classList.add('active');
}

function openAddVehicleModal() {
    closeModal('vehicle-selector-modal');
    document.getElementById('vehicle-modal-title').textContent = '–ù–æ–≤ –∞–≤—Ç–æ–º–æ–±–∏–ª';
    document.getElementById('veh-plate').value = '';
    document.getElementById('veh-name').value = '';
    document.getElementById('veh-km').value = '';
    document.getElementById('vehicle-modal').dataset.mode = 'add';
    document.getElementById('vehicle-modal').classList.add('active');
}

function editCurrentVehicle() {
    const v = getCurrentVehicle();
    if (!v) return;
    
    document.getElementById('vehicle-modal-title').textContent = '–†–µ–¥–∞–∫—Ü–∏—è –Ω–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª';
    document.getElementById('veh-plate').value = v.plate;
    document.getElementById('veh-name').value = v.name;
    document.getElementById('veh-km').value = v.km;
    document.getElementById('vehicle-modal').dataset.mode = 'edit';
    document.getElementById('vehicle-modal').classList.add('active');
}

function saveVehicle() {
    const plate = document.getElementById('veh-plate').value.trim();
    const name = document.getElementById('veh-name').value.trim();
    const km = parseInt(document.getElementById('veh-km').value) || 0;
    
    if (!plate || !name) {
        showNotification('–ú–æ–ª—è, –ø–æ–ø—ä–ª–Ω–µ—Ç–µ –≤—Å–∏—á–∫–∏ –ø–æ–ª–µ—Ç–∞!');
        return;
    }
    
    const mode = document.getElementById('vehicle-modal').dataset.mode;
    
    if (mode === 'edit') {
        const v = getCurrentVehicle();
        v.plate = plate;
        v.name = name;
        v.km = km;
    } else {
        data.vehicles.push({
            id: Date.now(),
            plate,
            name,
            km,
            documents: { tax: null, insurance: null, inspection: null, casco: null, vignette: null, fire: null },
            fuelHistory: []
        });
    }
    
    saveData();
    closeModal('vehicle-modal');
    updateUI();
    showNotification('–ó–∞–ø–∞–∑–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!');
}

function deleteCurrentVehicle() {
    if (data.vehicles.length <= 1) {
        showNotification('–¢—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ –ø–æ–Ω–µ –µ–¥–∏–Ω –∞–≤—Ç–æ–º–æ–±–∏–ª!');
        return;
    }
    
    if (confirm('–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ—Ç–µ —Ç–æ–∑–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª? –í—Å–∏—á–∫–∏ –¥–∞–Ω–Ω–∏ —â–µ –±—ä–¥–∞—Ç –∑–∞–≥—É–±–µ–Ω–∏!')) {
        data.vehicles = data.vehicles.filter(v => v.id !== data.currentVehicleId);
        data.currentVehicleId = data.vehicles[0].id;
        saveData();
        updateUI();
        showNotification('–ê–≤—Ç–æ–º–æ–±–∏–ª—ä—Ç –µ –∏–∑—Ç—Ä–∏—Ç!');
    }
}

function selectVehicle(id) {
    data.currentVehicleId = id;
    saveData();
    closeModal('vehicle-selector-modal');
    updateUI();
    showNotification('–ê–≤—Ç–æ–º–æ–±–∏–ª—ä—Ç –µ —Å–º–µ–Ω–µ–Ω!');
}

function openDocumentModal(type) {
    const v = getCurrentVehicle();
    const doc = v.documents[type];
    
    const titles = {
        tax: '–î–∞–Ω—ä–∫ –ú–ü–°',
        insurance: '–ì—Ä–∞–∂–¥–∞–Ω—Å–∫–∞ –æ—Ç–≥–æ–≤–æ—Ä–Ω–æ—Å—Ç',
        inspection: '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –ø—Ä–µ–≥–ª–µ–¥',
        casco: '–ö–∞—Å–∫–æ',
        vignette: '–í–∏–Ω–µ—Ç–∫–∞',
        fire: '–ü–æ–∂–∞—Ä–æ–≥–∞—Å–∏—Ç–µ–ª'
    };
    
    document.getElementById('doc-modal-title').textContent = titles[type];
    document.getElementById('doc-type').value = type;
    document.getElementById('doc-date').value = doc ? doc.date : '';
    document.getElementById('doc-price').value = doc ? doc.price : '';
    document.getElementById('doc-note').value = doc ? doc.note || '' : '';
    
    const deleteBtn = document.getElementById('btn-delete-doc');
    if (doc) {
        deleteBtn.classList.remove('hidden');
    } else {
        deleteBtn.classList.add('hidden');
    }
    
    document.getElementById('document-modal').classList.add('active');
}

function saveDocument() {
    const type = document.getElementById('doc-type').value;
    const date = document.getElementById('doc-date').value;
    const price = parseFloat(document.getElementById('doc-price').value) || 0;
    const note = document.getElementById('doc-note').value;
    
    if (!date) {
        showNotification('–ú–æ–ª—è, –≤—ä–≤–µ–¥–µ—Ç–µ –¥–∞—Ç–∞!');
        return;
    }
    
    const v = getCurrentVehicle();
    v.documents[type] = { date, price, note, notified: false };
    
    saveData();
    closeModal('document-modal');
    updateUI();
    showNotification('–ó–∞–ø–∞–∑–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!');
    
    // Schedule notification check
    checkNotifications();
}

function deleteDocument() {
    const type = document.getElementById('doc-type').value;
    const v = getCurrentVehicle();
    v.documents[type] = null;
    
    saveData();
    closeModal('document-modal');
    updateUI();
    showNotification('–ó–∞–ø–∏—Å—ä—Ç –µ –∏–∑—Ç—Ä–∏—Ç!');
}

function openFuelModal() {
    setDefaultDates();
    document.getElementById('fuel-modal').classList.add('active');
}

function openFuelHistory() {
    showView('fuel');
}

function saveFuel() {
    const date = document.getElementById('fuel-date').value;
    const fuelType = document.getElementById('fuel-type').value;
    const liters = parseFloat(document.getElementById('fuel-liters').value);
    const price = parseFloat(document.getElementById('fuel-price').value);
    const km = parseInt(document.getElementById('fuel-km').value);
    
    if (!date || !liters || !price || !km) {
        showNotification('–ú–æ–ª—è, –ø–æ–ø—ä–ª–Ω–µ—Ç–µ –≤—Å–∏—á–∫–∏ –ø–æ–ª–µ—Ç–∞!');
        return;
    }
    
    const v = getCurrentVehicle();
    
    // Update vehicle km if this is higher
    if (km > v.km) v.km = km;
    
    v.fuelHistory.push({
        id: Date.now(),
        date,
        fuelType,
        liters,
        price,
        km
    });
    
    saveData();
    closeModal('fuel-modal');
    updateUI();
    showNotification('–ó–∞—Ä–µ–∂–¥–∞–Ω–µ—Ç–æ –µ –∑–∞–ø–∏—Å–∞–Ω–æ!');
    
    // Clear form
    document.getElementById('fuel-liters').value = '';
    document.getElementById('fuel-price').value = '';
    document.getElementById('fuel-km').value = '';
}

function setDefaultDates() {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('fuel-date').value = today;
    document.getElementById('doc-date').value = today;
}

function closeModal(id) {
    document.getElementById(id).classList.remove('active');
}

function showView(view) {
    document.getElementById('main-view').classList.add('hidden');
    document.getElementById('fuel-view').classList.add('hidden');
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    
    if (view === 'main') {
        document.getElementById('main-view').classList.remove('hidden');
        document.getElementById('nav-main').classList.add('active');
    } else if (view === 'fuel') {
        document.getElementById('fuel-view').classList.remove('hidden');
        document.getElementById('nav-fuel').classList.add('active');
        const v = getCurrentVehicle();
        updateFuelList(v);
    }
}

function openAddMenu() {
    // Simple toggle between vehicle add and fuel add
    const options = ['–î–æ–±–∞–≤–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ', '–ù–æ–≤ –∞–≤—Ç–æ–º–æ–±–∏–ª', '–û—Ç–∫–∞–∑'];
    const choice = confirm('–î–æ–±–∞–≤—è–Ω–µ –Ω–∞...\n–ù–∞—Ç–∏—Å–Ω–µ—Ç–µ –û–ö –∑–∞ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ —Å –≥–æ—Ä–∏–≤–æ\n–ù–∞—Ç–∏—Å–Ω–µ—Ç–µ –û—Ç–∫–∞–∑ –∑–∞ –æ—Ç–∫–∞–∑\n(–ó–∞ –Ω–æ–≤ –∞–≤—Ç–æ–º–æ–±–∏–ª –∏–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ –º–µ–Ω—é—Ç–æ "–ê–≤—Ç–æ–º–æ–±–∏–ª–∏")');
    
    if (choice) {
        openFuelModal();
    }
}

function checkNotifications() {
    if (!('Notification' in window) || Notification.permission !== 'granted') return;
    
    const v = getCurrentVehicle();
    if (!v) return;
    
    const docNames = {
        tax: '–î–∞–Ω—ä–∫ –ú–ü–°',
        insurance: '–ì—Ä–∞–∂–¥–∞–Ω—Å–∫–∞ –æ—Ç–≥–æ–≤–æ—Ä–Ω–æ—Å—Ç',
        inspection: '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –ø—Ä–µ–≥–ª–µ–¥',
        casco: '–ö–∞—Å–∫–æ',
        vignette: '–í–∏–Ω–µ—Ç–∫–∞',
        fire: '–ü–æ–∂–∞—Ä–æ–≥–∞—Å–∏—Ç–µ–ª'
    };
    
    Object.keys(v.documents).forEach(type => {
        const doc = v.documents[type];
        if (!doc || !doc.date || doc.notified) return;
        
        const days = getDaysLeft(doc.date);
        
        if (days <= 7 && days >= 0) {
            new Notification('AutoFleet', {
                body: `${v.plate}: ${docNames[type]} –∏–∑—Ç–∏—á–∞ —Å–ª–µ–¥ ${days} –¥–Ω–∏!`,
                icon: 'üöó'
            });
            doc.notified = true;
            saveData();
        } else if (days < 0) {
            new Notification('AutoFleet', {
                body: `${v.plate}: ${docNames[type]} –µ –ò–ó–¢–ï–ö–™–õ!`,
                icon: '‚ö†Ô∏è'
            });
            doc.notified = true;
            saveData();
        }
    });
}

function formatDate(dateStr) {
    return new Date(dateStr).toLocaleDateString('bg-BG');
}

function showNotification(text) {
    const n = document.getElementById('notification');
    n.textContent = text;
    n.classList.add('show');
    setTimeout(() => n.classList.remove('show'), 3000);
}

// Close modals on outside click
document.querySelectorAll('.modal-overlay').forEach(modal => {
    modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.classList.remove('active');
    });
});

// Initialize app
init();

// Service Worker for PWA
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('data:text/javascript,' + encodeURIComponent(`
        self.addEventListener('install', e => e.waitUntil(self.skipWaiting()));
        self.addEventListener('activate', e => e.waitUntil(self.clients.claim()));
        self.addEventListener('fetch', e => e.respondWith(fetch(e.request).catch(() => new Response('Offline'))));
    `)).catch(() => {});
}
</script>

</body>
</html>